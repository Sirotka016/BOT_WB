# BOT_WB

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–∞–±–∏–Ω–µ—Ç–æ–º Wildberries Seller. –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∫ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–¥–∞–∫—à–Ω-–∑–∞–ø—É—Å–∫—É: –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ-—è–∫–æ—Ä—å, –Ω–∞–¥—ë–∂–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ WB Seller, –µ–¥–∏–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞–±–æ—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫ –∫–∞—á–µ—Å—Ç–≤–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements-dev.txt
pip install -e .
cp .env.example .env
# –∑–∞–ø–æ–ª–Ω–∏—Ç–µ BOT_TOKEN –∏ –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
python -m playwright install chromium
python -m bot_wb
```

> –ü—Ä–æ–µ–∫—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –Ω–∞ `aiogram` –≤–µ—Ä—Å–∏–∏ `3.7` –∏ –≤—ã—à–µ (–¥–æ `4.0`).
> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `parse_mode`/`disable_web_page_preview`/`protect_content`
> –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `DefaultBotProperties` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `Bot`.

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

–°–ø–æ—Å–æ–± A (–±—ã—Å—Ç—Ä—ã–π):
    python main.py

–°–ø–æ—Å–æ–± B (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
    pip install -e .
    python -m bot_wb

## üîí Single instance

- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª-–±–ª–æ–∫–∏—Ä–æ–≤–∫—É `data/bot_wb.lock`, –∏—Å–∫–ª—é—á–∞—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º `Another BOT_WB instance is already running` –∏ –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É `getUpdates`.

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|-----------------------|------------|
| `BOT_TOKEN` | ‚Äî | –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞. –û–±—è–∑–∞—Ç–µ–ª–µ–Ω. |
| `LOG_LEVEL` | `INFO` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`DEBUG`/`INFO`/`WARNING`/`ERROR`). |
| `WB_SELLER_BASE` | `https://seller.wildberries.ru` | –ë–∞–∑–æ–≤—ã–π URL –∫–∞–±–∏–Ω–µ—Ç–∞ WB Seller. |
| `WB_SELLER_AUTH_URL` | `https://seller-auth.wildberries.ru/‚Ä¶` | URL —Ñ–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ WB Seller. |
| `DATA_DIR` | `data` | –ö–∞—Ç–∞–ª–æ–≥ —Å –±–∞–∑–æ–π –∏ —Å–µ—Å—Å–∏—è–º–∏ (`data/sessions/<tg_id>/cookies.json`). |

## üß™ –¢–µ—Å—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

```bash
pytest
ruff check src tests
black --check src tests
isort --check-only src tests
mypy src
```

–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pre-commit`:

```bash
pre-commit install
pre-commit run --all-files
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `src/bot_wb/main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ middlewares.
- `src/bot_wb/logging.py` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è loguru (—Ü–≤–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤).
- `src/bot_wb/middlewares/` ‚Äî –ª–æ–≥-–∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
- `src/bot_wb/services/` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Playwright –∏ HTTP-–∫–ª–∏–µ–Ω—Ç WB.
- `src/bot_wb/storage/` ‚Äî SQLite –∏ —Ñ–∞–π–ª–æ–≤—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–µ—Å—Å–∏–π.
- `tests/` ‚Äî pytest + asyncio/respx/aiogram-tests.

## ‚ùóÔ∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –î–ª—è headful Playwright –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `xvfb` –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ.
- –ó–∞–≥–ª—É—à–∫–∏ WB API (`list_organizations`, `set_active_organization`) –µ—â—ë –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Ä—É—á–∫–∞–º ‚Äî –≤ –∫–æ–¥–µ –ø–æ–º–µ—á–µ–Ω–æ `TODO`.
- –¢–µ—Å—Ç—ã –º–æ–∫–∞—é Playwright –∏ HTTP-–∑–∞–ø—Ä–æ—Å—ã: –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ e2e-–ø—Ä–æ–≤–µ—Ä–∫–∏.
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `aiogram-tests` –ø–æ–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ aiogram v2, –ø–æ—ç—Ç–æ–º—É —Ç–µ—Å—Ç —Å –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `xfail`/skip –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ –ø–æ–¥ v3.
